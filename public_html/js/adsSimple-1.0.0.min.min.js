var adsSimple=adsSimple||{};
(function(c){c.pathBase="http://ads.nicovideo.jp";c.version="1.0.0";var f=c.Class={create:function(a){var b,d=function(){this.initialize&&this.initialize.apply(this,arguments)};if(a)for(b in a)d[b]=a[b];return d}},e=c.Utility={extend:function(a,b){for(var d in b)a[d]=b[d]},toQueryString:function(a){var b="",d;for(d in a)b+=d+"="+encodeURIComponent(a[d])+"&";return b.slice(0,b.length-1)}},l=c.Advertisement=f.create();e.extend(l.prototype,{zone:null,category:null,elementid:null,view:null,initialize:function(a){if("number"!==
typeof a.zone)throw Error("zone is not number.");this.zone=a.zone;this.category=[].concat(a.category||[]);this.view=new g},getElement:function(){var a=document.getElementById(this.elementid);a&&(this.getElement=function(){return a});return a},setElementId:function(a){if(!document.getElementById(a))throw Error(a+" is not found.");this.elementid=a},setAdvertisement:function(a){h.getAdvertisements(a.zone,a.category,function(b){a.callback(b)})},set:function(a){this.setElementId(a);this.setAdvertisement(this);
return this},callback:function(a){if(a.message)throw Error(a.message);this.view.display(this,a.data.pop())}});var h=c.Api=f.create({count:0,prefix:"ads_callback",url:{OxBannerService:{getAdvertisements:"/api/OxBannerService/getAdvertisements.jsonp?",logImpression:"/api/OxBannerService/logImpression?"}},getAdvertisements:function(a,b,d){this.loadScript(c.pathBase+this.url.OxBannerService.getAdvertisements,{zone:a,category:b.join(","),callback:this.setCallback(d)})},logImpression:function(a,b){this.loadScript(c.pathBase+
this.url.OxBannerService.logImpression,{bannerid:a,zoneid:b})},loadScript:function(a,b){var d=document,c=d.createElement("script");c.src=a+e.toQueryString(b)+"&_="+(new Date).getTime();c.type="text/javascript";c.charset="utf-8";d.getElementsByTagName("head")[0].appendChild(c)},setCallback:function(a){var b=this.prefix+"_"+this.count++;window[b]=function(c){a(c);window[b]=void 0};return b}}),g=c.View=f.create();e.extend(g.prototype,{display:function(a,b){a.getElement().innerHTML+=(new k(a,b)).getTag();
h.logImpression(b.bannerid,b.zoneid)}});var k=c.Template=f.create();e.extend(k.prototype,{advertisement:null,response:null,bannertextVars:null,initialize:function(a,b){this.advertisement=a;this.response=b;this.bannertextVars={}},getTag:function(){var a=null;this.isText()?a=this.link(this.getBannertext()):this.isImage()?a=this.link(this.getTagForImage()):this.isHtml()&&(a=this.getTagForHtml());return a},getBannertext:function(){return this.response.bannertext||""},getTagForImage:function(){var a;a=
'<img src="%IMAGE_PATH%" alt="%BANNERTEXT%" border="0"/>'.replace("%IMAGE_PATH%",this.getImagePath());return a=a.replace("%BANNERTEXT%",this.getBannertext())},getTagForHtml:function(){var a="",a=navigator&&navigator.userAgent&&-1===navigator.userAgent.toLowerCase().indexOf("firefox")?'<iframe src="%TEXT_PATH%" vspace="0" hspace="0" marginwidth="0" marginheight="0" width="%WIDTH%" height="%HEIGHT%" frameborder="0" scrolling="no" allowTransparency="true" noresize></iframe>':'<object data="%TEXT_PATH%" vspace="0" hspace="0" marginwidth="0" marginheight="0" type="text/html" width="%WIDTH%" height="%HEIGHT%" border="0"></object>',
a=a.replace("%TEXT_PATH%",this.getBannertextPath()),a=a.replace("%WIDTH%",this.getWidth());return a=a.replace("%HEIGHT%",this.getHeight())},setBannertextVars:function(a,b){this.bannertextVars[a]=b},getImagePath:function(){return c.pathBase+"/assets/images/"+this.response.filename},getClickPath:function(){return c.pathBase+"/click?"+e.toQueryString({bannerid:this.response.bannerid,zoneid:this.response.zoneid})},getBannertextPath:function(){return c.pathBase+"/bannertext?"+e.toQueryString({bannerid:this.response.bannerid,
zoneid:this.response.zoneid})+"&"+e.toQueryString(this.bannertextVars)},getWidth:function(){return 0<parseInt(this.response.width||0,10)?parseInt(this.response.width||0,10):this.advertisement.getElement().offsetWidth||0},getHeight:function(){return 0<parseInt(this.response.height||0,10)?parseInt(this.response.height,10):this.advertisement.getElement().offsetHeight||0},link:function(a){var b;b='<a href="%CLICK_PATH%" target="_blank">%HTML%</a>'.replace("%CLICK_PATH%",this.getClickPath());return b=
b.replace("%HTML%",a)},isImage:function(){return"gif"===this.response.contenttype||"jpeg"===this.response.contenttype||"png"===this.response.contenttype},isText:function(){return"txt"===this.response.contenttype},isHtml:function(){return"html"===this.response.contenttype}})})(adsSimple);
